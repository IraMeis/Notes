# Автоматическое распараллеливание ациклических фрагментов последовательных программ (построение стандартного графа и графа зависимостей)
![[Важные понятия, которые нужно запомнить#Последовательная программа]]
## Стандартный граф
В первую очередь построим по такой программе стандартный граф. Последний характеризуется двумя типами вершин (преобразователи, распознаватели) и дугами. Преобразователи соответствуют операторам присваивания и обозначаются на графе прямоугольниками, распознаватели – операторам условных переходов и обозначаются окружностями. Один преобразователь может быть связан с несколькими операторами присваивания (расположенными в тексте программы рядом без пропусков); при том один оператор всегда соотносится только с одной вершиной. Один распознаватель связан лишь с одним условным переходом и наоборот. 

Дуги стандартного графа задаются бинарным отношением непосредственного следования на множестве вершин, которое в свою очередь определяется последовательностью расположения операторов друг за другом в тексте программы и условными переходами. Из преобразователя выходит не более одной дуги, из распознавателя не более двух. Дуга, соответствующая истинности условия, связанного с распознавателем, маркируется цифрой 1, ложности – 0. Вершину, в которую не входит ни одна дуга, назовем входной; из которой не выходит не одна дуга – выходной вершиной стандартного графа. 

Продолжая пример из прошлой главы, связанный с решением квадратного уравнения, несколько усложним его, допустив произвольное значение дискриминанта. Для записи программы используем язык, совпадающий с ранее введенной (пункт 1.2.2) алгоритмической нотацией. 

В тексте Программы 2.1 все переменные действительного типа, за исключением $res$, в которой хранится строка. Операция “$+$” применяется в том числе для объединения строк, функция “*str*” переводит действительную величину в строчную.
![[Pasted image 20220612155631.png]]
На рис. 2.1 а изображен стандартный граф для Программы 2.1 с входной вершиной A и выходной H. Маркировка операторов программы и соответствующих им вершин совпадает. Вершины A, B, D, E, F, G, H – преобразователи. Дуги, выходящие из единственной вершины – распознавателя C обозначены оговоренным ранее образом.
![[Pasted image 20220612155644.png]]
## Граф зависимостей
За этапом построения стандартного графа следует формирование графа зависимостей. Вершины обоих графов совпадают, а функции инцидентности разнятся. Зависимостями будем называть следующие три бинарных отношения на множестве вершин нового графа. Их общее (без различия типа отношения) транзитивное замыкание задает дуги графа зависимостей.
### Информативная зависимость
Будем говорить, что вершина A' информационно зависит от вершины A, если они лежат на одном пути стандартного графа из входной вершины в выходную, при чем A предшествует A', и хотя бы в одном из операторов, относящихся к вершине A, изменяется значение переменной, которую не перезаписывает, но использует хотя бы один оператор, относящийся к вершине A': $Out(A)\cap\left( \frac{In(A')}{Out(A')} \right) \neq \emptyset$. Более того, на указанном пути между A и A' отсутствует вершина A'', связанная с хотя бы одним оператором программы, меняющим значение упомянутой переменой

В приведенной формуле запись Out(A) обозначает множество всех переменных (элементов массивов), расположенных в левой части операторов присваивания, связанных с вершиной A; In(A') – множество всех переменных (элементов массивов), расположенных в правой части операторов присваивания, связанных с A', если эта вершина преобразователь, или формирующих условие, если A' – распознаватель. В общем случае $In(A')\cap Out(A')\neq \emptyset$ – одна и та же переменная может присутствовать в связанном с A' операторе присваивания по обе его части. Тогда, для обозначения ситуации «не перезаписывает, но использует», верна нотация $In(A')/Out(A')$. Информационную зависимость вершины от самой себя исключим, как не имеющею смысла в рассматриваемом контексте (свойство антирефлексивности информационной зависимости). 

Как следует из определения, вершина от которой информационно зависят – всегда преобразователь, которая информационно зависит – может быть как преобразователем, так и распознавателем. 

Возвращаясь к примеру с программой 2.1, нанесем на граф зависимостей (рис. 2.1 б) дуги, соответствующие бинарному отношению информационной зависимости, изобразив их непрерывными линиями со стрелками на конце без дополнительной маркировки. Сравнивая графы на рис. 2.1 а и 2.1 б отметим появившиеся различия. Так, на стандартном графе вершина С непосредственно следует за В, а на графе зависимостей C информационно от В не зависит. И наоборот, на рис. 2.1 а из A в C нет дуги, а на рис. 2.1 б есть.
### Логическая зависимость
Будем говорить, что вершина A' логически зависит от вершины A, если они лежат на одном пути стандартного графа из входной вершины в выходную, при чем A предшествует A', и существует другой путь на стандартном графе из входной вершины в выходную, совпадающий с первым вплоть до А включительно, далее отличающийся от него и не содержащий A'. 

Значит вершина от которой логически зависят – всегда распознаватель, которая логически зависит – может быть как преобразователем, так и распознавателем. 

В примере на рис. 2.1 б логические зависимости обозначены непрерывными дугами, маркированными в начале (при выходе из распознавателя) литерами “л”. Может показаться, что все вершины, следующие за C в стандартном графе, должны логически от C зависеть. Однако на рис. 2.1 б такой зависимости для H нет, почему? Дело в том, что через H действительно проходит путь стандартного графа, в котором C предшествует H, и существует другой путь, отличающийся от первого сразу после C. Однако оба упомянутых пути содержат вершину H, в силу чего она не зависит логически от C. С каким бы значением условия не выполнился оператор условного перехода, связанный с C, оператор, относящийся к H, далее в ходе вычислительного процесса будет обязательно исполнен.
### Конкуреционная зависимость
Будем говорить, что вершина A' конкуренционно зависит от вершины A, если они лежат на одном пути стандартного графа из входной вершины в выходную, при чем A предшествует A', и хотя бы в одном из операторов, относящихся к вершине A, изменяется значение переменной, которая также модифицируется хотя бы в одном операторе, относящимся к вершине A': $Out(A)\cap(Out(A'))\neq \emptyset$. 

К случаю конкуренционной зависимости отнесем ситуацию, когда в операторе, связанном с вершиной A', оговариваемая переменная присутствует по обе стороны от символа присваивания. В конкуренционную зависимость вступают исключительно преобразователи. 

В рассматриваемом примере Программы 2.1 конкуренционные зависимости отсутствуют. 

Завершая формирование графа зависимостей откажемся от различения их типов, необходимого только на предыдущих этапах построения, произведя транзитивное замыкание. Дополнительные дуги, появившиеся в результате этой операции, изображены на рис. 2.1 а пунктирными. 

В итоге, вершина H все-таки оказалась зависимой от P. С каким бы значением условия не выполнился оператор условного перехода, связанный с C, важно, что он выполнился и исполнение оператора, относящегося к H, должно следовать позже. А значит Н зависит от P, пусть и не логически. 

Далее зависимость вершины A' от A будем записывать как $dep(A,A')$, обращаясь к графу зависимостей. Если же речь пойдет о пути, то смотреть будем на стандартный граф.